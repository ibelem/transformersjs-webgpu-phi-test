<html>

<head>
  <title>Transformers.js 3.7.6 / ORT Web 1.22.0-dev.20250409 / Phi-4-mini-instruct-ONNX-GQA</title>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link type="text/css" rel="stylesheet" href="./style.css" />
</head>

<body>
  <h3>Transformers.js 3.7.6 / ORT Web 1.22.0-dev.20250409 / Phi-4-mini-instruct-ONNX-GQA</h3>

  <div class="test">
    <div id="question">Solve the equation: x^2 + 2x - 3 = 0</div>
    <div id="result">Please wait util the result returns, or open the Developer Tools to check the test status / progress</div>
  </div>

  <table>
    <thead>
      <tr>
        <th>Transformers.js</th>
        <th>ONNX Runtime Web</th>
        <th colspan="3">WebGPU - Phi Mini Test</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td>3.7.6</td>
        <td>1.22.0-dev.20250409-89f8206ba4 (Legacy JSEP)</td>
        <td><a href='t3-p35.html'
            title="onnx-community/Phi-3.5-mini-instruct-onnx-web">Phi-3.5-mini-instruct-onnx-web</a> <span class="pass">PASS</span></td>
        <td><a href='t3-p4gqa.html' title="onnx-community/Phi-4-mini-instruct-ONNX-GQA">Phi-4-mini-instruct-ONNX-GQA</a> <span class="error">Uncaught 11078672</span>
        </td>
        <td><a href='t3-p4mha.html' title="onnx-community/Phi-4-mini-instruct-ONNX-MHA">Phi-4-mini-instruct-ONNX-MHA</a> <span class="error">Uncaught 12922160</span>
        </td>
      </tr>
      <tr>
        <td>v4 (self-built before offical release)</td>
        <td>1.24.0-dev.20251104-75d35474d5 (WebGPU EP)</td>
        <td><a href='t4-p35.html'
            title="onnx-community/Phi-3.5-mini-instruct-onnx-web">Phi-3.5-mini-instruct-onnx-web</a> <span class="pass">PASS</span></td>
        <td><a href='t4-p4gqa.html' title="onnx-community/Phi-4-mini-instruct-ONNX-GQA">Phi-4-mini-instruct-ONNX-GQA <span class="error">Model file error</span></a> 
        </td>
        <td><a href='t4-p4mha.html' title="onnx-community/Phi-4-mini-instruct-ONNX-MHA">Phi-4-mini-instruct-ONNX-MHA <span class="error">Model file error</span></a>
        </td>
      </tr>
    </tbody>
  </table>
</body>
<script type="module">
  import { pipeline } from "./transformers.js-dist/3.7.6/transformers.min.js";

  // Create a text generation pipeline
  const generator = await pipeline(
    "text-generation",
    "onnx-community/Phi-4-mini-instruct-ONNX-GQA",
    {
      device: 'webgpu',
      dtype: 'q4f16',
      session_options: {
        logSeverityLevel: 0
      },
    }
  );

  // Define the list of messages
  const messages = [
    { role: "system", content: "You are a helpful assistant." },
    { role: "user", content: "Solve the equation: x^2 + 2x - 3 = 0" },
  ];

  // Generate a response
  const output = await generator(messages, { max_new_tokens: 256, do_sample: false });
  document.querySelector('#result').innerHTML = output[0].generated_text.at(-1).content;
  console.log(output[0].generated_text.at(-1).content);
</script>

</html>